---
title: Role-Based Access Control with Keycloak
description: Configure and use role-based access control (RBAC) with Flipt, Keycloak, and OPA.
---

As described in the [Authorization Overview](/authorization/overview), Flipt supports the ability to secure its core API routes with authorization in a flexible and extensible way.

This guide will cover how to configure and use role-based access control (RBAC) with Flipt with a Rego policy configured for an imaginary organization using Keycloak for authentication.

<Note>
  Role-based access control (RBAC) is not a feature of Flipt itself but rather a
  pattern that can be implemented using Flipt's authorization system via OPA.
</Note>

## What You'll Learn

- üîí How to set up Keycloak for authorization
- üîë How to create a Rego policy for RBAC with Flipt
- ‚öôÔ∏è How to configure Flipt to use the policy for authorization

## Prerequisites

For this guide, you will need:

- [Docker](https://www.docker.com/)
- [Follow the Login with Keycloak guide](/guides/operation/authentication/login-with-keycloak) to set up Keycloak for authentication

## Setting Up Keycloak

To set up Keycloak for authorization, you'll first need to create a new realm, client, and user.

### Step 1: Follow the Login with Keycloak Guide

Follow the [Login with Keycloak guide](/guides/operation/authentication/login-with-keycloak) to set up Keycloak for authentication.

This guide will walk you through setting up Keycloak and creating a realm, client, and user that you will use for this guide.

![Flipt UI presenting login with Keycloak button](/images/guides/login-with-keycloak/login-with-keycloak.png)

### Step 2: Create a Realm Role

1. Click on the `Realm Roles` tab.
1. Click `Create Role`.
1. Enter `developer` as the role name and description and click `Save`.

![Create Role](/images/guides/rbac-with-keycloak/create-keycloak-role.png)

### Step 3: Assign the Role to a User

1. Click on the `Users` tab.
1. Click on the `user` user.
1. Click on the `Role Mappings` tab.
1. Click `Assign Role`.
1. Select the `developer` role and click `Assign`.

![Assign Role](/images/guides/rbac-with-keycloak/assign-keycloak-role.png)

### Step 4: Map Client Scopes

Map the `roles` scope to the `flipt` client:

1. Click on the `Clients Scopes` tab.
1. Click on `roles` in the list of client scopes.
1. Click on the `Mappers` tab.
1. Click on `realm roles` in the list of mappers.

![Map Client Scopes](/images/guides/rbac-with-keycloak/map-client-scopes.png)

5. Set the `Token Claim Name` field to something short like `roles`.
6. Set the `Claim JSON Type` field to `String`.
7. Toggle on `Add to ID token`.
8. Click `Save`.

![Customize Role Mapper](/images/guides/rbac-with-keycloak/customize-role-mapper.png)

## Configuring RBAC in Flipt

To configure RBAC with Flipt, you will need to define a Rego policy that enforces the roles and permissions for your organization.

Here's an example of a simple policy that checks whether a user has the `developer` role:

```rego
package flipt.authz

default allow = false

allow {
    input.authentication.metadata[_].roles[_] == "developer"
}
```

In this example, the policy checks if the user has the `developer` role. If the user has the `developer` role, the policy will allow the request. Otherwise, the request will be denied.

The `authentication` input is provided by Flipt to OPA and contains the authentication information for the request. This information is specific to the authentication method used to authenticate the request.

More complex policies can be defined to enforce fine-grained access control based on your organization's requirements. For example, you could define policies that check for specific roles and permissions for different resources or actions.

An example policy that allows users with the `developer` role to have full access to the Management API and users with the `viewer` role to have read-only access might look like this:

```rego
package flipt.authz

default allow = false

allow {
    input.authentication.metadata[_].roles[_] == "developer"
}

allow {
    input.authentication.metadata[_].roles[_] == "viewer"
    input.request.verb = "read"
}
```
