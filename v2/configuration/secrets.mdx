---
title: Secrets Management
description: Secure external secret integration with HashiCorp Vault and file-based providers
---

Flipt v2 supports external secrets management, allowing you to store sensitive configuration data like API keys, tokens, and certificates outside of your main configuration files. This enhances security by centralizing secret management and reducing the risk of accidentally exposing sensitive data.

## Why Use External Secrets?

Instead of storing sensitive values directly in configuration files, external secrets provide:

- **Enhanced Security**: Sensitive data is stored in dedicated secret management systems with proper access controls
- **Centralized Management**: All secrets managed in one place with audit trails and access policies
- **Environment Separation**: Different secrets for development, staging, and production environments
- **Rotation Support**: Easy secret rotation without updating configuration files
- **Access Control**: Fine-grained permissions for who can access which secrets

## Supported Providers

Flipt supports multiple secret providers to fit different deployment scenarios:

<CardGroup cols={2}>
  <Card title="File Provider" icon="folder">
    Store secrets in local files - ideal for development and simple deployments
  </Card>
  <Card title="HashiCorp Vault" icon="vault">
    Enterprise-grade secret management with advanced authentication and access
    controls
  </Card>
</CardGroup>

## Configuration Overview

Enable secrets management by configuring providers in your Flipt configuration:

```yaml
secrets:
  providers:
    # Multiple providers can be configured
    file:
      enabled: true
      base_path: "/etc/flipt/secrets"
    vault:
      enabled: true
      address: "https://vault.company.com"
      auth_method: "token"
```

## File Provider

The file provider is the simplest option, storing secrets as files on the local filesystem.

### Configuration

```yaml
secrets:
  providers:
    file:
      enabled: true
      base_path: "/etc/flipt/secrets" # Default: /etc/flipt/secrets
```

### Usage

Create secret files in the configured directory:

```bash
# Create a directory for secrets
mkdir -p /etc/flipt/secrets

# Store an API key
echo "sk-1234567890abcdef" > /etc/flipt/secrets/api-key

# Store a certificate
cat certificate.pem > /etc/flipt/secrets/tls-cert
```

### Docker Example

Mount secrets into your container:

```yaml
# docker-compose.yml
services:
  flipt:
    image: flipt/flipt:latest
    volumes:
      - ./secrets:/etc/flipt/secrets:ro
    environment:
      - FLIPT_CONFIG_PATH=/etc/flipt/config.yml
```

## HashiCorp Vault Provider

Vault provides enterprise-grade secret management with advanced features like dynamic secrets, encryption as a service, and detailed audit logs.

### Basic Configuration

```yaml
secrets:
  providers:
    vault:
      enabled: true
      address: "https://vault.company.com"
      auth_method: "token"
      token: "hvs.your_vault_token"
      mount: "secret" # Default: secret
```

### Authentication Methods

#### Token Authentication

Best for development and testing:

```yaml
vault:
  enabled: true
  address: "https://vault.company.com"
  auth_method: "token"
  token: "hvs.your_vault_token"
```

#### Kubernetes Authentication

Ideal for Kubernetes deployments:

```yaml
vault:
  enabled: true
  address: "https://vault.company.com"
  auth_method: "kubernetes"
  role: "flipt-role"
  mount: "secret"
```

#### AppRole Authentication

Good for automated systems and CI/CD:

```yaml
vault:
  enabled: true
  address: "https://vault.company.com"
  auth_method: "approle"
  role: "flipt-role"
  mount: "secret"
```

### Environment Variables

Avoid storing sensitive values in configuration files by using environment variables:

```bash
export FLIPT_SECRETS_PROVIDERS_VAULT_TOKEN="hvs.your_vault_token"
export FLIPT_SECRETS_PROVIDERS_VAULT_ROLE_ID="your_role_id"
export FLIPT_SECRETS_PROVIDERS_VAULT_SECRET_ID="your_secret_id"
```

### Vault Setup Example

1. **Create a policy for Flipt**:

```bash
vault policy write flipt-policy - <<EOF
path "secret/data/flipt/*" {
  capabilities = ["read"]
}
EOF
```

2. **Create a token with the policy**:

```bash
vault token create -policy=flipt-policy -ttl=24h
```

3. **Store secrets in Vault**:

```bash
vault kv put secret/flipt/api-key value="sk-1234567890abcdef"
vault kv put secret/flipt/database-password value="super_secure_password"
```

## Using Secrets in Configuration

Once providers are configured, reference secrets in other parts of your Flipt configuration:

```yaml
# Example: Using a secret for database password
storage:
  default:
    type: "postgres"
    postgres:
      host: "localhost"
      password:
        provider: "vault"
        path: "flipt/database-password"
        key: "value"

# Example: Using a secret for API authentication
authentication:
  methods:
    api_key:
      secret:
        provider: "file"
        path: "api-key"
```

## Common Use Cases

### Development Environment

Use file provider for local development:

```yaml
secrets:
  providers:
    file:
      enabled: true
      base_path: "./secrets"
```

### Production with Vault

Use Vault with Kubernetes authentication:

```yaml
secrets:
  providers:
    vault:
      enabled: true
      address: "https://vault.company.com"
      auth_method: "kubernetes"
      role: "flipt-production"
      namespace: "production"
```

### Multi-Environment Setup

Configure different providers for different environments:

```yaml
secrets:
  providers:
    # Development secrets from files
    file:
      enabled: true
      base_path: "/etc/flipt/dev-secrets"
    # Production secrets from Vault
    vault:
      enabled: true
      address: "https://vault.company.com"
      auth_method: "kubernetes"
      role: "flipt-production"
```

## Troubleshooting

### Common Issues

**Connection Errors**

- Verify Vault address is accessible from Flipt
- Check network connectivity and firewall rules
- Ensure Vault is running and healthy

**Authentication Failures**

- Verify token has correct permissions
- Check role configuration for Kubernetes/AppRole auth
- Confirm environment variables are set correctly

**Secret Not Found**

- Verify secret path exists in the provider
- Check mount path configuration
- Ensure proper permissions to read the secret

**File Provider Issues**

- Verify base_path directory exists and is readable
- Check file permissions (Flipt process needs read access)
- Ensure secret files contain the expected content

### Debug Configuration

Enable debug logging to troubleshoot issues:

```yaml
log:
  level: "debug"
```

This will show detailed information about secret provider initialization and secret retrieval attempts.

## Security Best Practices

- **Never store secrets in configuration files** - always use external providers
- **Use least privilege access** - grant only necessary permissions to Flipt
- **Rotate secrets regularly** - leverage your secret provider's rotation capabilities
- **Monitor access** - review audit logs for secret access patterns
- **Separate environments** - use different secret paths/policies for dev/staging/production
- **Secure transport** - always use HTTPS/TLS for Vault communication
