---
title: Secrets
description: Secrets integration with file-based and external secret providers
---

Flipt v2 supports external secrets management, allowing you to store sensitive configuration data like API keys, tokens, and certificates outside of your main configuration files.

This enhances security by centralizing secret management and reducing the risk of accidentally exposing sensitive data.

## Why Use External Secrets?

Instead of storing sensitive values directly in Flipt configuration files, external secrets provide:

- **Enhanced Security**: Sensitive data is stored in dedicated secret management systems with proper access controls
- **Centralized Management**: All secrets managed in one place with audit trails and access policies
- **Environment Separation**: Different secrets for development, staging, and production environments
- **Rotation Support**: Easy secret rotation without updating configuration files (coming soon)
- **Access Control**: Fine-grained permissions for who can access which secrets

## Supported Providers

Flipt supports multiple secret providers to fit different deployment scenarios:

<Tip>
  We're working on adding support for more secret providers, including AWS
  Secrets Manager, Azure Key Vault, and Google Cloud Secret Manager.
</Tip>

<CardGroup cols={2}>
  <Card title="File Provider" icon="folder">
    Store secrets in local files - ideal for development and simple deployments
  </Card>
  <Card title="HashiCorp Vault" icon="vault">
    Enterprise-grade secret management with advanced authentication and access
    controls
  </Card>
</CardGroup>

## Configuration Overview

Enable secrets management by configuring providers in your Flipt configuration:

```yaml
secrets:
  providers:
    # Multiple providers can be configured
    file:
      enabled: true
      base_path: "/etc/flipt/secrets"
    vault:
      enabled: true
      address: "https://vault.company.com"
      auth_method: "token"
```

## File Provider

The file provider is the simplest option, storing secrets in a JSON file in the configured directory.

### Configuration

```yaml
secrets:
  providers:
    file:
      enabled: true
      base_path: "/etc/flipt/secrets" # Default: /etc/flipt/secrets
```

### Usage

Create secret files in the configured directory:

```bash
# Create a JSON file for secrets
echo '{"data": {"api-key": "sk-1234567890abcdef"}}' > /etc/flipt/secrets/secrets.json
```

<Note>Ensure the JSON file is valid and the `data` key is present.</Note>

For secrets that would be invalid JSON such as those that container newlines you can either escape the newlines or base64 encode the secret.

```bash
echo "-----BEGIN PGP PRIVATE KEY BLOCK-----\n\n-----END PGP PRIVATE KEY BLOCK-----\n" | base64 -w 0 > /etc/flipt/secrets/gpg-key.asc
```

```json
{
  "data": {
    "gpg-key": "{base64 encoded secret}"
  }
}
```

## HashiCorp Vault Provider

Vault provides enterprise-grade secret management with advanced features like dynamic secrets, encryption as a service, and detailed audit logs.

### Basic Configuration

```yaml
secrets:
  providers:
    vault:
      enabled: true
      address: "https://vault.company.com"
      auth_method: "token"
      token: "hvs.your_vault_token"
      mount: "secret" # Default: secret
```

### Authentication Methods

#### Token Authentication

Best for development and testing:

```yaml
vault:
  enabled: true
  address: "https://vault.company.com"
  auth_method: "token"
  token: "hvs.your_vault_token"
```

#### Kubernetes Authentication

Ideal for Kubernetes deployments:

```yaml
vault:
  enabled: true
  address: "https://vault.company.com"
  auth_method: "kubernetes"
  role: "flipt-role"
  mount: "secret"
```

#### AppRole Authentication

Good for automated systems and CI/CD:

```yaml
vault:
  enabled: true
  address: "https://vault.company.com"
  auth_method: "approle"
  role: "flipt-role"
  mount: "secret"
```

### Environment Variables for Provider Configuration

Avoid storing sensitive provider configuration in config files by using environment variables:

```bash
export FLIPT_SECRETS_PROVIDERS_VAULT_TOKEN="hvs.your_vault_token"
export FLIPT_SECRETS_PROVIDERS_VAULT_ROLE_ID="your_role_id"
export FLIPT_SECRETS_PROVIDERS_VAULT_SECRET_ID="your_secret_id"
```

Or reference them using the new v2 environment variable syntax:

```yaml
secrets:
  providers:
    vault:
      enabled: true
      address: ${env:VAULT_ADDR}
      token: ${env:VAULT_TOKEN}
      auth_method: "token"
```

## Using Secrets in Configuration

Secrets can be referenced throughout your Flipt v2 configuration using the `${secret:reference}` syntax. This allows you to keep sensitive values secure while maintaining readable configuration files.

### Reference Formats

#### Simple Format

Use the default or first configured provider:

```yaml
authentication:
  session:
    csrf:
      key: ${secret:csrf-key}
  methods:
    github:
      client_secret: ${secret:github-token}
```

#### Complex Format

Explicitly specify the provider, path, and key:

```yaml
authentication:
  methods:
    oidc:
      client_id: ${secret:vault:auth/oidc:client_id}
      client_secret: ${secret:vault:auth/oidc:client_secret}
    github:
      client_secret: ${secret:file:github-token}
```

### Complete Configuration Example

Here's a comprehensive example showing secret references with multiple providers:

```yaml
# Enable multiple secret providers
secrets:
  providers:
    file:
      enabled: true
      base_path: "/etc/flipt/secrets"
    vault:
      enabled: true
      address: "https://vault.company.com"
      auth_method: "kubernetes"
      role: "flipt-role"

# Use secrets throughout configuration
server:
  http_port: ${env:HTTP_PORT} # Environment variable
  cert_file: ${secret:file:tls-cert} # File provider secret
  cert_key: ${secret:file:tls-key} # File provider secret

authentication:
  session:
    csrf:
      key: ${secret:vault:auth/csrf:key} # Vault provider secret
  methods:
    github:
      client_id: ${env:GITHUB_CLIENT_ID} # Environment variable
      client_secret: ${secret:github-token} # Default provider secret
    oidc:
      client_id: ${secret:vault:auth/oidc:client_id} # Vault provider
      client_secret: ${secret:vault:auth/oidc:client_secret} # Vault provider

storage:
  default:
    signature:
      enabled: true
      key_ref:
        provider: "vault"
        path: "signing/gpg"
        key: "private_key"
```

### Provider-Specific Examples

#### File Provider Secrets

Create secret files in your configured base path:

```bash
# /etc/flipt/secrets/secrets.json
{
  "data": {
    "github-token": "ghp_your_github_token",
    "csrf-key": "your-csrf-secret-key",
    "tls-cert": "-----BEGIN CERTIFICATE-----...",
    "tls-key": "-----BEGIN PRIVATE KEY-----..."
  }
}
```

Reference them in configuration:

```yaml
authentication:
  session:
    csrf:
      key: ${secret:file:csrf-key}
  methods:
    github:
      client_secret: ${secret:file:github-token}
```

#### HashiCorp Vault Secrets

Store secrets in Vault at specific paths:

```bash
# Store secrets in Vault
vault kv put secret/auth/oidc client_id="your-oidc-client-id" client_secret="your-oidc-secret"
vault kv put secret/auth/csrf key="your-csrf-secret-key"
```

Reference them in configuration:

```yaml
authentication:
  session:
    csrf:
      key: ${secret:vault:auth/csrf:key}
  methods:
    oidc:
      client_id: ${secret:vault:auth/oidc:client_id}
      client_secret: ${secret:vault:auth/oidc:client_secret}
```

### Combining Environment Variables and Secrets

You can mix environment variables (`${env:VAR}`) and secret references (`${secret:ref}`) in the same configuration:

```yaml
server:
  http_port: ${env:HTTP_PORT} # Environment variable
  https_port: ${env:HTTPS_PORT} # Environment variable
  cert_file: ${secret:tls-cert} # Secret reference
  cert_key: ${secret:tls-key} # Secret reference

authentication:
  required: ${env:AUTH_REQUIRED} # Environment variable
  session:
    domain: ${env:SESSION_DOMAIN} # Environment variable
    csrf:
      key: ${secret:csrf-key} # Secret reference
```

<Tip>
  Use environment variables for non-sensitive configuration values and secret
  references for sensitive data like API keys, tokens, and certificates.
</Tip>
