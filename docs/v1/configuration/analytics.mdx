---
title: Analytics
description: This document describes various configuration mechanisms for controlling analytics for Flipt.
---

## Analytics

Flipt includes functionality for reporting analytical data to a configurable storage engine.

Currently, Flipt has support for collecting data into the following storage engines:

- [ClickHouse](https://clickhouse.com/)
- [Prometheus](https://prometheus.io/)

The data that gets collected currently includes:

- Flag Evaluation Count

Once a storage engine is configured, these analytics are viewable in the UI allowing users to visualize up to 24 hours of data for each metric.

![UI For Analytics](/v1/images/configuration/analytics_quick_view.png)

The image above shows the past 30 minutes of the flag `flag1` evaluation counts.

### Origin

Analytics are currently only collected as they pass through the evaluation server. This means that analytics will be captured if you are using the REST or GRPC APIs via one of our [Server SDKs](/v1/integration/server/rest) or [GRPC SDKs](/v1/integration/server/grpc) for evaluations.

We have plans to support collecting analytics for [Client-Side](/v1/integration/client) evaluations in the future.

## ClickHouse

You can use a self-hosted ClickHouse instance or a [managed instance](https://clickhouse.com/cloud/) to store your analytics data.

We highly **recommend** using a separate database for analytics produced by Flipt. This ensures that Flipt analytic data can be logically isolated from the rest of your Clickhouse data.

<Note>
  The analytics database must be created before Flipt will be able to write
  analytical data and run any migrations. See our
  [migration](/v1/configuration/storage#migrations) section for more info.
</Note>

To create a database for Flipt analytics, you can use the following SQL:

```sql
CREATE DATABASE IF NOT EXISTS flipt_analytics;
```

See the [ClickHouse documentation](https://clickhouse.com/docs) for more information on how to get started with ClickHouse.

### Configuration

To configure Flipt to use ClickHouse for analytics, you will need to add the following configuration to your `config.yml` file or environment variables:

<Tabs>
  <Tab title="Environment Variables">

    ```bash
    FLIPT_ANALYTICS_STORAGE_CLICKHOUSE_ENABLED=true
    FLIPT_ANALYTICS_STORAGE_CLICKHOUSE_URL=clickhouse://clickhouse:9000/flipt_analytics
    ```

  </Tab>
  <Tab title="Configuration YAML">

    ```yaml
    analytics:
      storage:
        clickhouse:
          enabled: true
          url: clickhouse://clickhouse:9000/flipt_analytics
    ```

  </Tab>
</Tabs>

## Prometheus

You can use any [Prometheus](https://prometheus.io/docs/introduction/overview/) server to store your analytics data.

### Configuration

To configure Flipt to use Prometheus for analytics, you will need to add the following configuration to your `config.yml` file or environment variables:

<Tabs>
  <Tab title="Environment Variables">

    ```bash
    FLIPT_ANALYTICS_STORAGE_PROMETHEUS_ENABLED=true
    FLIPT_ANALYTICS_STORAGE_PROMETHEUS_URL=http://prometheus:9090
    ```

  </Tab>
  <Tab title="Configuration YAML">

    ```yaml
    analytics:
      storage:
        prometheus:
          enabled: true
          url: http://prometheus:9090
    ```

  </Tab>
</Tabs>

### Custom Headers

You can also add custom headers to the Prometheus requests by setting the `analytics.storage.prometheus.headers` configuration property. This can be useful if you are using a proxy or need to add additional authentication headers.

```yaml
analytics:
  storage:
    prometheus:
      headers:
        "Authorization": "Bearer <token>"
```

### AWS SigV4 Authentication

Flipt supports [AWS Signature Version 4 (SigV4)](https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html) authentication for Prometheus, which is required when using [Amazon Managed Service for Prometheus (AMP)](https://aws.amazon.com/prometheus/).

To enable SigV4 authentication, add the `sigv4` section under your Prometheus analytics configuration:

<Tabs>
  <Tab title="Environment Variables">

    ```bash
    FLIPT_ANALYTICS_STORAGE_PROMETHEUS_ENABLED=true
    FLIPT_ANALYTICS_STORAGE_PROMETHEUS_URL=https://aps-workspaces.<region>.amazonaws.com/workspaces/<workspace-id>
    FLIPT_ANALYTICS_STORAGE_PROMETHEUS_SIGV4_REGION=<region>
    FLIPT_ANALYTICS_STORAGE_PROMETHEUS_SIGV4_ACCESS_KEY=<access-key-id>
    FLIPT_ANALYTICS_STORAGE_PROMETHEUS_SIGV4_SECRET_KEY=<secret-access-key>
    ```

  </Tab>
  <Tab title="Configuration YAML">

    ```yaml
    analytics:
      storage:
        prometheus:
          enabled: true
          url: https://aps-workspaces.<region>.amazonaws.com/workspaces/<workspace-id>
          sigv4:
            region: <region>
            access_key: <access-key-id>
            secret_key: <secret-access-key>
    ```

  </Tab>
</Tabs>

#### SigV4 Configuration Options

| Property                                              | Description                                                                  | Default |
| ----------------------------------------------------- | ---------------------------------------------------------------------------- | ------- |
| analytics.storage.prometheus.sigv4.region             | AWS region where your Prometheus workspace is located                        |         |
| analytics.storage.prometheus.sigv4.access_key         | AWS access key ID for authentication                                         |         |
| analytics.storage.prometheus.sigv4.secret_key         | AWS secret access key for authentication                                     |         |
| analytics.storage.prometheus.sigv4.profile            | AWS profile to use from the credentials file                                 |         |
| analytics.storage.prometheus.sigv4.role_arn           | AWS IAM role ARN to assume for authentication                                |         |

<Note>
  If `access_key` and `secret_key` are not provided, Flipt will fall back to the
  [default AWS credential chain](https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html#specifying-credentials)
  (environment variables, shared credentials file, IAM instance profile, etc.).
</Note>

#### Using IAM Roles

For production deployments, we recommend using IAM roles instead of static credentials. You can use the `role_arn` field to specify a role to assume, or rely on the instance profile attached to your EC2 instance or ECS task:

```yaml
analytics:
  storage:
    prometheus:
      enabled: true
      url: https://aps-workspaces.<region>.amazonaws.com/workspaces/<workspace-id>
      sigv4:
        region: <region>
        role_arn: arn:aws:iam::<account-id>:role/<role-name>
```
