---
title: Overview
description: This document describes how to enable and use authorization with Flipt.
---

Flipt supports the ability to secure its core API routes with authorization.

<Info>
Flipt authorization is **disabled** (not required) by default.

Head to the [Configuration: Authorization](/configuration/authorization) section to learn how to enable it.

</Info>

Once enabled, all routes beneath the Management API prefix will require a [client token](#client-tokens) or [JWT](#json-web-tokens) to authenticate requests along with the required permissions:

- `/api/v1/`

### Policies

Flipt uses OPA to enforce authorization policies for the Management API. The policies are defined in a `policy.rego` file located in the Flipt configuration directory by default. The path to this file can be customized as described in the [Configuration: Authorization](/configuration/authorization) section.

Part of the power of OPA is that it's extremely flexible as it allows you to define fine-grained policies tailored to your exact needs.

Here's an example of a simple policy that checks whether a user has the `admin` role:

```rego
package flipt.authz

default allow = false

allow {
    input.authentication.roles[_] == "admin"
}
```
You can find more information on how to write Rego policies in the [OPA documentation](https://www.openpolicyagent.org/docs/latest/policy-language/).

<Tip>
OPA has a rich set of built-in functions that can be used to write complex policies. They also provide a [Rego Playground](https://play.openpolicyagent.org/) where you can test your policies before deploying them.
</Tip>

It's up to you to define the policies that make sense for your organization. During policy evaluation, Flipt will pass the incoming request context to OPA, which will then evaluate the policy against that context.

The context provided to OPA includes the following fields:

- `input.authentication`: The authentication information for the request. These are specific to each authentication provider/method and can include things like the user's roles, email, etc.
- `input.request`: The incoming request details, such as the `namespace`, `resource`, and `verb`.

### Authentication Information

Flipt provides the raw authentication information to OPA for evaluation. This information is specific to the authentication method used to authenticate the request. For example, if you're using the [OIDC authentication method](/authentication/methods#openid-connect), the `input.authentication` field may contain the user's roles, email, etc., as provided by the OIDC provider.

Here is an example of the `input.authentication` field for a request authenticated using a example OIDC provider:

```json
{
    "roles": ["admin", "editor"],
    "email": "user@email.com",
    "name": "John Doe"
}
```

The above example policy would allow this request since the user has the `admin` role.

#### Mapping User Information

Each authentication method used to authenticate requests with Flipt will provide different information about the user. It's up to you to map this information to roles that can be used in your policies.

Some authentication methods provide user details such as roles directly, while others may provide a user ID or email that you can use to look up roles in your own system. Many authentication providers support adding custom claims to the JWT token, which can be used to provide additional information about the user.

For example, [Okta](https://www.okta.com/) allows you to add custom claims using their groups feature. An example JWT token with custom claims generated by Okta might look like this:

```json
{
  "sub": "00uixa271s6x7qt8I0h7",
  "ver": 1,
  "iss": "https://{yourOktaDomain}",
  "aud": "0oaoiuhhch8VRtBnC0h7",
  "iat": 1574201516,
  "exp": 1574205116,
  "jti": "ID.ewMNfSvcpuqyS93OgVeCN3F2LseqROkyYjz7DNb9yhs",
  "amr": [
    "pwd",
    "mfa",
    "kba"
  ],
  "idp": "00oixa26ycdNcX0VT0h7",
  "nonce": "UBGW",
  "auth_time": 1574201433,
  "groups": [
    "Everyone",
    "IT"
  ]
}
```

In this example, the `groups` claim is used to provide the user's organizational groups. You can then write a policy that checks for the presence of specific groups to determine whether the user should be allowed to access a particular resource.

```rego
package flipt.authz

default allow = false

allow {
    "IT" in input.authentication.groups
}
```

Further documentation on how to configure custom claims and groups in Okta can be found in the [Okta Developer documentation](https://developer.okta.com/docs/guides/customize-tokens-returned-from-okta/main/).


Roles or groups are not a requirement for writing policies. You can write policies that check for any information provided by the authentication method, such as the user's email, id, name, etc.

<Info>
Flipt has no notion of users or roles internally, it simply passes the raw authentication information along with other request metadata to OPA for evaluation.
</Info>

### Request Information

The `input.request` field contains information about the incoming request. This includes the `namespace`, `resource`, and `verb` of the request.

- `namespace`: The [namespace](/concepts#namespaces) in Flipt of the resource being accessed. If no namespace is provided, the default namespace is used.
- `resource`: The resource being accessed. This can be one of:
  - `flag`: Access to flag resources and sub-resources (e.g., listing or creating flags, variants, rules or rollouts).
  - `segment`: Access to segment resources and sub-resources (e.g., listing or creating segments, constraints or distributions).
  - `namespace`: Access to namespace resource (e.g., listing or creating namespaces).
  - `token`: Access to client token resources (e.g., listing or creating client tokens).
- `verb`: The action being performed on the resource. This can be one of:
  - `create`: Access to create resources.
  - `read`: Access to list or read resources.
  - `update`: Access to update resources.
  - `delete`: Access to delete resources.

Here's an example of the `input.request` field for a request to list flags in the default namespace:

```json
{
    "namespace": "default",
    "resource": "flag",
    "verb": "read"
}
```

Here is an example policy that allows a user to list flags in the default namespace:

```rego
package flipt.authz

default allow = false

allow {
    input.request.namespace == "default"
    input.request.resource == "flag"
    input.request.verb == "read"
}
```

Combining the above policy with the user information policy from the previous example, you can create a policy that allows users with the `IT` group to delete flags in the default namespace:

```rego
package flipt.authz

default allow = false

allow {
    "IT" in input.authentication.groups
    input.request.namespace == "default"
    input.request.resource == "flag"
    input.request.verb == "delete"
}
```